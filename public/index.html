<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chqser Casino</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    html {
      height: 100%;
      margin: 0;
      padding: 0;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
      background: #0f172a;
      color: #e2e8f0;
      overflow-x: hidden;
      margin: 0;
      padding: 0;
      height: 100%;
    }

    /* Login Screen */
    .login-container {
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
    }

    .login-box {
      background: linear-gradient(135deg, #1e293b 0%, #334155 100%);
      padding: 50px;
      border-radius: 20px;
      border: 1px solid #475569;
      text-align: center;
      min-width: 400px;
      box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
    }

    .login-box h1 {
      font-size: 2.5em;
      margin-bottom: 10px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .login-box p {
      color: #94a3b8;
      margin-bottom: 30px;
    }

    .login-input {
      width: 100%;
      padding: 15px;
      margin-bottom: 20px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #475569;
      border-radius: 10px;
      color: #e2e8f0;
      font-size: 1em;
      transition: all 0.3s;
    }

    .login-input:focus {
      outline: none;
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.05);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.2);
    }

    .login-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border: none;
      border-radius: 10px;
      color: #0f172a;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s;
    }

    .login-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
    }

    .discord-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #5865F2 0%, #4752C4 100%);
      border: none;
      border-radius: 10px;
      color: white;
      font-weight: bold;
      font-size: 1.1em;
      cursor: pointer;
      transition: all 0.3s;
      margin-bottom: 15px;
    }

    .discord-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(88, 101, 242, 0.3);
    }

    /* Main Layout */
    .main-layout {
      display: none;
      min-height: 100vh;
      background: #0f172a;
    }

    .main-layout.active {
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 280px;
      background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
      border-right: 1px solid #475569;
      padding: 20px;
      overflow-y: auto;
      max-height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      z-index: 100;
    }

    .sidebar-logo {
      font-size: 1.8em;
      font-weight: bold;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      text-align: center;
    }

    .sidebar-section {
      margin-bottom: 30px;
    }

    .sidebar-title {
      font-size: 0.8em;
      color: #64748b;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 15px;
      font-weight: 600;
    }

    .game-button {
      width: 100%;
      padding: 15px;
      margin-bottom: 10px;
      background: rgba(255, 255, 255, 0.05);
      border: 1px solid transparent;
      border-radius: 10px;
      color: #cbd5e1;
      text-align: left;
      cursor: pointer;
      transition: all 0.3s;
      font-size: 0.95em;
      font-weight: 500;
    }

    .game-button:hover {
      background: rgba(0, 255, 136, 0.1);
      border-color: #00ff88;
      color: #e2e8f0;
    }

    .game-button.active {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      color: #0f172a;
      border-color: transparent;
      font-weight: 600;
    }

    /* Main Content */
    .content-wrapper {
      flex: 1;
      margin-left: 280px;
      display: flex;
      flex-direction: column;
      min-height: 100vh;
    }

    /* Header */
    .header {
      background: linear-gradient(180deg, #1e293b 0%, transparent 100%);
      border-bottom: 1px solid #475569;
      padding: 20px 30px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      backdrop-filter: blur(10px);
    }

    .balance-display {
      display: flex;
      gap: 30px;
      align-items: center;
    }

    .balance-card {
      text-align: right;
    }

    .balance-label {
      font-size: 0.8em;
      color: #94a3b8;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-bottom: 5px;
    }

    .balance-value {
      font-size: 1.8em;
      font-weight: bold;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .logout-btn {
      padding: 10px 20px;
      background: rgba(255, 59, 48, 0.1);
      border: 1px solid #ff3b30;
      border-radius: 8px;
      color: #ff3b30;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .logout-btn:hover {
      background: rgba(255, 59, 48, 0.2);
    }

    .unlink-btn {
      padding: 10px 20px;
      background: rgba(100, 200, 255, 0.1);
      border: 1px solid #00ccff;
      border-radius: 8px;
      color: #00ccff;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
      margin-right: 10px;
    }

    .unlink-btn:hover {
      background: rgba(0, 204, 255, 0.2);
    }

    /* Content Area */
    .content-area {
      flex: 1;
      padding: 30px;
      overflow-y: auto;
    }

    .game-section {
      display: none;
      animation: fadeIn 0.5s ease;
      overflow-x: auto;
    }

    .game-section.active {
      display: block;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(20px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .game-title {
      font-size: 2.5em;
      margin-bottom: 30px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    /* Game Grid */
    .game-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }

    .game-card {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 1px solid #475569;
      border-radius: 15px;
      padding: 30px;
      transition: all 0.3s;
    }

    .game-card:hover {
      border-color: #00ff88;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.2);
    }

    .game-info {
      margin-bottom: 20px;
    }

    .game-odds {
      font-size: 0.85em;
      color: #64748b;
      margin: 10px 0;
    }

    .form-group {
      margin-bottom: 15px;
    }

    .form-label {
      display: block;
      font-size: 0.85em;
      color: #cbd5e1;
      margin-bottom: 8px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .form-input,
    .form-select {
      width: 100%;
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 1px solid #475569;
      border-radius: 8px;
      color: #e2e8f0;
      font-size: 1em;
      transition: all 0.3s;
    }

    .form-input:focus,
    .form-select:focus {
      outline: none;
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.05);
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.1);
    }

    .choice-buttons {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 15px;
    }

    .choice-btn {
      padding: 12px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid #475569;
      border-radius: 8px;
      color: #cbd5e1;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .choice-btn:hover {
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.1);
    }

    .choice-btn.selected {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border-color: transparent;
      color: #0f172a;
    }

    .number-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-bottom: 15px;
    }

    .number-btn {
      padding: 10px;
      background: rgba(0, 0, 0, 0.3);
      border: 2px solid #475569;
      border-radius: 8px;
      color: #cbd5e1;
      cursor: pointer;
      transition: all 0.3s;
      font-weight: 600;
    }

    .number-btn:hover {
      border-color: #00ff88;
      background: rgba(0, 255, 136, 0.1);
    }

    .number-btn.selected {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border-color: transparent;
      color: #0f172a;
    }

    .play-btn {
      width: 100%;
      padding: 15px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border: none;
      border-radius: 10px;
      color: #0f172a;
      font-weight: bold;
      font-size: 1em;
      cursor: pointer;
      transition: all 0.3s;
    }

    .play-btn:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
    }

    .play-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
      transform: none;
    }

    /* Game Results */
    .result-modal {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      display: none;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }

    .result-modal.show {
      display: flex;
      animation: fadeIn 0.3s ease;
    }

    .result-content {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      padding: 50px;
      border-radius: 20px;
      border: 1px solid #475569;
      text-align: center;
      min-width: 500px;
      max-width: 600px;
    }

    .result-title {
      font-size: 2.5em;
      font-weight: bold;
      margin-bottom: 20px;
      animation: bounceIn 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    }

    .result-win {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .result-lose {
      color: #ff3b30;
    }

    @keyframes bounceIn {
      0% {
        transform: scale(0.3);
        opacity: 0;
      }
      50% {
        opacity: 1;
      }
      70% {
        transform: scale(1.05);
      }
      100% {
        transform: scale(1);
      }
    }

    .result-details {
      background: rgba(0, 0, 0, 0.3);
      padding: 25px;
      border-radius: 12px;
      margin: 25px 0;
      border: 1px solid #475569;
      animation: slideUp 0.6s ease;
    }

    @keyframes slideUp {
      from {
        transform: translateY(20px);
        opacity: 0;
      }
      to {
        transform: translateY(0);
        opacity: 1;
      }
    }

    .result-amount {
      font-size: 1.5em;
      margin: 15px 0;
      font-weight: bold;
    }

    .result-win-amount {
      color: #00ff88;
    }

    .result-lose-amount {
      color: #ff3b30;
    }

    .modal-buttons {
      display: flex;
      gap: 15px;
      margin-top: 30px;
    }

    .modal-buttons button {
      flex: 1;
      padding: 12px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border: none;
      border-radius: 10px;
      color: #0f172a;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .modal-buttons button:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0, 255, 136, 0.3);
    }

    /* Animations */
    @keyframes spin {
      from { transform: rotateZ(0deg); }
      to { transform: rotateZ(1080deg); }
    }

    @keyframes bounce {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-20px); }
    }

    @keyframes diceRoll {
      0% { transform: rotateX(0deg) rotateY(0deg) rotateZ(0deg); }
      25% { transform: rotateX(720deg) rotateY(720deg) rotateZ(360deg); }
      50% { transform: rotateX(1080deg) rotateY(1440deg) rotateZ(720deg); }
      75% { transform: rotateX(1440deg) rotateY(2160deg) rotateZ(1080deg); }
      100% { transform: rotateX(1800deg) rotateY(2880deg) rotateZ(1440deg); }
    }

    @keyframes ballDrop {
      0% {
        top: 10px;
        opacity: 1;
      }
      100% {
        top: 250px;
        opacity: 0.8;
      }
    }

    .dice-animation {
      animation: spin 0.8s ease-out;
    }

    .dice-roll-animation {
      animation: diceRoll 1.2s ease-out;
    }

    .flip-animation {
      animation: spin 0.8s ease-out;
    }

    .spin-animation {
      animation: spin 1.2s ease-out;
    }

    /* Blackjack */
    .blackjack-container {
      max-width: 800px;
      margin: 0 auto;
    }

    .blackjack-table {
      background: radial-gradient(ellipse at center, #1e293b 0%, #0f172a 100%);
      border: 2px solid #00ff88;
      border-radius: 15px;
      padding: 30px;
      margin-bottom: 20px;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .dealer-hand,
    .player-hand {
      margin: 20px 0;
    }

    .hand-label {
      color: #64748b;
      font-size: 0.9em;
      margin-bottom: 10px;
      text-transform: uppercase;
    }

    .hand-cards {
      display: flex;
      gap: 15px;
      flex-wrap: wrap;
    }

    .card {
      width: 80px;
      height: 120px;
      background: white;
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: bold;
      font-size: 1.2em;
      box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
      animation: slideUp 0.3s ease;
    }

    .card.red {
      color: #ff3b30;
    }

    .card.black {
      color: #000;
    }

    .hand-total {
      margin-top: 10px;
      color: #cbd5e1;
      font-weight: bold;
    }

    .blackjack-buttons {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin-top: 20px;
    }

    .blackjack-btn {
      padding: 12px 30px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      border: none;
      border-radius: 10px;
      color: #0f172a;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
    }

    .blackjack-btn:hover:not(:disabled) {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
    }

    .blackjack-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    /* Message */
    .message {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 25px;
      border-radius: 10px;
      display: none;
      z-index: 999;
      animation: slideInRight 0.3s ease;
    }

    .message.show {
      display: block;
    }

    @keyframes slideInRight {
      from {
        transform: translateX(400px);
        opacity: 0;
      }
      to {
        transform: translateX(0);
        opacity: 1;
      }
    }

    .message.success {
      background: rgba(0, 255, 136, 0.2);
      border: 1px solid #00ff88;
      color: #00ff88;
    }

    .message.error {
      background: rgba(255, 59, 48, 0.2);
      border: 1px solid #ff3b30;
      color: #ff3b30;
    }

    /* Deposit Tab */
    .deposit-info {
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 2px solid #00ff88;
      border-radius: 15px;
      padding: 40px;
      text-align: center;
      max-width: 600px;
      margin: 0 auto;
    }

    .deposit-title {
      font-size: 2em;
      margin-bottom: 20px;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .house-account {
      background: rgba(0, 255, 136, 0.1);
      border: 2px solid #00ff88;
      padding: 25px;
      border-radius: 12px;
      margin: 30px 0;
      font-size: 1.3em;
      font-weight: bold;
    }

    .command-box {
      background: rgba(0, 0, 0, 0.5);
      padding: 20px;
      border-radius: 10px;
      margin: 20px 0;
      font-family: 'Courier New', monospace;
      color: #00ff88;
      border: 1px solid #00ff88;
      word-break: break-all;
    }

    /* PROFESSIONAL GAME STYLING */
    .game-board {
      background: linear-gradient(135deg, #1a2332 0%, #0f172a 100%);
      border: 2px solid #00ff88;
      border-radius: 15px;
      padding: 30px;
      margin: 20px 0;
      min-height: 300px;
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    /* DICE WHEEL */
    .dice-wheel {
      width: 200px;
      height: 200px;
      margin: 20px auto;
      position: relative;
      perspective: 1000px;
    }

    .wheel-item {
      position: absolute;
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2em;
      font-weight: bold;
      color: #00ff88;
      border: 2px solid #00ff88;
      border-radius: 50%;
      background: rgba(0, 255, 136, 0.1);
      transform: rotateZ(0deg) translateY(-100px) rotateZ(0deg);
    }

    @keyframes wheelSpin {
      0% { transform: rotateZ(0deg); }
      100% { transform: rotateZ(3600deg); }
    }

    .wheel-spinning {
      animation: wheelSpin 3s cubic-bezier(0.2, 0.46, 0.15, 0.89) !important;
    }

    /* SLOT REELS */
    .reel-container {
      display: flex;
      justify-content: center;
      gap: 20px;
      margin: 30px 0;
    }

    .reel {
      width: 120px;
      height: 180px;
      background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
      border: 3px solid #00ff88;
      border-radius: 10px;
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }

    .reel-content {
      display: flex;
      flex-direction: column;
      gap: 10px;
      transition: transform 0.5s ease;
    }

    .reel-symbol {
      width: 120px;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4em;
    }

    @keyframes reel-spin {
      0% { transform: translateY(0); }
      100% { transform: translateY(-3600px); }
    }

    .reel-spinning {
      animation: reel-spin 2s cubic-bezier(0.2, 0.46, 0.15, 0.89);
    }

    /* COIN FLIP */
    .coin {
      width: 150px;
      height: 150px;
      margin: 30px auto;
      border-radius: 50%;
      border: 3px solid #00ff88;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3em;
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      color: #0f172a;
      font-weight: bold;
      box-shadow: 0 0 30px rgba(0, 255, 136, 0.4);
    }

    @keyframes coin-flip {
      0% { transform: rotateY(0deg) rotateZ(0deg); }
      50% { transform: rotateY(1800deg) rotateZ(360deg); }
      100% { transform: rotateY(3600deg) rotateZ(720deg); }
    }

    .coin-flipping {
      animation: coin-flip 1.5s ease-out;
    }

    /* PLINKO PEGBOARD */
    .plinko-board {
      width: 100%;
      height: 400px;
      background: linear-gradient(180deg, rgba(15,23,42,0.8) 0%, rgba(15,23,42,0.5) 100%);
      border: 2px solid #00ff88;
      border-radius: 10px;
      position: relative;
      overflow: hidden;
      margin: 20px 0;
    }

    .peg {
      position: absolute;
      width: 12px;
      height: 12px;
      background: #00ff88;
      border-radius: 50%;
      box-shadow: 0 0 10px rgba(0, 255, 136, 0.6);
    }

    .plinko-ball {
      position: absolute;
      width: 16px;
      height: 16px;
      background: radial-gradient(circle at 30% 30%, #00ffff, #00ff88);
      border-radius: 50%;
      box-shadow: 0 0 15px rgba(0, 255, 136, 0.8);
      z-index: 10;
    }

    @keyframes ball-fall {
      0% { top: 20px; left: 50%; opacity: 1; }
      100% { top: 380px; left: 50%; opacity: 0.6; }
    }

    .ball-falling {
      animation: ball-fall 2.5s ease-in;
    }

    /* Mines removed */

    /* CRASH GRAPH */
    .crash-graph {
      width: 100%;
      height: 250px;
      background: linear-gradient(180deg, #1e293b 0%, #0f172a 100%);
      border: 2px solid #00ff88;
      border-radius: 10px;
      margin: 20px 0;
      position: relative;
      overflow: hidden;
    }

    .crash-line {
      position: absolute;
      bottom: 0;
      left: 0;
      width: 2px;
      background: linear-gradient(180deg, #00ff88 0%, #00ccff 100%);
      transition: height 0.1s linear;
    }

    .crash-multiplier-display {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 2.5em;
      font-weight: bold;
      color: #00ff88;
      text-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
    }

    /* NUMBER WHEEL */
    .number-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 15px;
      margin: 20px 0;
    }

    .number-tile {
      aspect-ratio: 1;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 2px solid #475569;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 1.8em;
      font-weight: bold;
      color: #cbd5e1;
      cursor: pointer;
      transition: all 0.3s;
    }

    .number-tile:hover {
      border-color: #00ff88;
      color: #00ff88;
      transform: scale(1.05);
      box-shadow: 0 0 20px rgba(0, 255, 136, 0.3);
    }

    .number-tile.selected {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      color: #0f172a;
      border-color: #00ff88;
    }

    /* TOWERS */
    .tower-level {
      display: flex;
      gap: 15px;
      justify-content: center;
      margin: 15px 0;
    }

    .tower-choice {
      padding: 15px 25px;
      background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
      border: 2px solid #00ff88;
      border-radius: 10px;
      color: #00ff88;
      font-weight: bold;
      cursor: pointer;
      transition: all 0.3s;
      min-width: 100px;
      text-align: center;
    }

    .tower-choice:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
      border-color: #00ccff;
    }

    .tower-choice.safe {
      background: rgba(0, 255, 136, 0.1);
    }

    .tower-choice.revealed-safe {
      background: linear-gradient(135deg, #00ff88 0%, #00ccff 100%);
      color: #0f172a;
    }

    .tower-choice.revealed-bomb {
      background: rgba(255, 59, 48, 0.2);
      border-color: #ff3b30;
      color: #ff3b30;
    }

    @media (max-width: 768px) {
      .sidebar {
        width: 100%;
        height: auto;
        position: static;
        border-right: none;
        border-bottom: 1px solid #475569;
      }

      .content-wrapper {
        margin-left: 0;
      }

      .login-box {
        min-width: 90%;
      }

      .result-content {
        min-width: 90%;
        padding: 30px;
      }

      .game-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div id="loginScreen" class="login-container">
    <div class="login-box">
      <h1>üé∞ Tomato4444 Casino</h1>
      <p id="loginMessage">Secure Account Access</p>
      
      <!-- Login with Discord -->
      <div id="discordLoginSection">
        <button class="discord-btn" onclick="loginWithDiscord()">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" style="display: inline-block; margin-right: 8px; vertical-align: middle;">
            <path d="M20.317 4.37a19.791 19.791 0 0 0-4.885-1.515a.074.074 0 0 0-.079.037c-.211.375-.444.864-.607 1.25a18.27 18.27 0 0 0-5.487 0c-.163-.386-.395-.875-.607-1.25a.077.077 0 0 0-.079-.037A19.736 19.736 0 0 0 3.677 4.37a.07.07 0 0 0-.032.027C.533 9.046-.32 13.58.099 18.057a.082.082 0 0 0 .031.057a19.9 19.9 0 0 0 5.993 3.03a.078.078 0 0 0 .084-.028a14.975 14.975 0 0 0 1.293-2.1a.07.07 0 0 0-.038-.098a13.11 13.11 0 0 1-1.872-.892a.072.072 0 0 1-.007-.12a10.15 10.15 0 0 0 .372-.294a.074.074 0 0 1 .077-.01c3.928 1.793 8.18 1.793 12.062 0a.074.074 0 0 1 .078.01c.12.098.246.195.373.294a.072.072 0 0 1-.006.12a12.977 12.977 0 0 1-1.873.892a.077.077 0 0 0-.037.099a14.915 14.915 0 0 0 1.293 2.1a.076.076 0 0 0 .084.028a19.963 19.963 0 0 0 6.002-3.03a.079.079 0 0 0 .033-.057c.5-4.467.151-8.34-.434-12.657a.061.061 0 0 0-.031-.027zM8.02 15.33c-1.183 0-2.157-.967-2.157-2.156c0-1.193.969-2.157 2.157-2.157c1.193 0 2.157.964 2.157 2.157c0 1.19-.964 2.156-2.157 2.156zm7.975 0c-1.183 0-2.157-.967-2.157-2.156c0-1.193.969-2.157 2.157-2.157c1.193 0 2.157.964 2.157 2.157c0 1.19-.964 2.156-2.157 2.156z"/>
          </svg>
          Login with Discord
        </button>
        <div style="margin: 20px 0; color: #64748b; font-size: 0.9em;">
          ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
        </div>
        <p style="color: #64748b; font-size: 0.85em; margin-bottom: 15px;">Or use traditional login:</p>
      </div>
      
      <!-- Traditional Username Login -->
      <div id="usernameLoginSection">
        <input type="text" id="loginUsername" class="login-input" placeholder="Your Minecraft username" autocomplete="off">
        <button class="login-btn" onclick="login()">Enter Casino</button>
      </div>
      
      <!-- Account Linking Section (shown after Discord auth) -->
      <div id="linkingSection" style="display: none;">
        <div style="background: rgba(0, 255, 136, 0.1); border: 2px solid #00ff88; padding: 20px; border-radius: 10px; margin-bottom: 20px;">
          <p style="color: #00ff88; font-weight: bold; margin-bottom: 10px;">‚úÖ Discord Authenticated!</p>
          <p style="color: #cbd5e1; font-size: 0.9em; margin-bottom: 15px;">Your linking code is:</p>
          <div style="background: rgba(0, 0, 0, 0.3); padding: 15px; border-radius: 8px; text-align: center; margin-bottom: 15px;">
            <code id="linkingCode" style="font-size: 1.4em; font-weight: bold; color: #00ff88; font-family: monospace; letter-spacing: 3px;">XXXXXX</code>
          </div>
          <p style="color: #cbd5e1; font-size: 0.85em; margin-bottom: 15px;">Send this in Minecraft:</p>
          <div style="background: rgba(0, 0, 0, 0.3); padding: 10px; border-radius: 8px; text-align: center;">
            <code style="color: #00ccff; font-family: monospace;">/msg Tomato4444 &lt;code&gt;</code>
          </div>
          <p style="color: #94a3b8; font-size: 0.8em; margin-top: 15px;">Example: /msg Tomato4444 ABC123</p>
        </div>
        <p style="color: #cbd5e1; margin-bottom: 15px; text-align: center;">Waiting for verification in-game...</p>
        <button class="login-btn" id="linkingWaitBtn" style="background: #475569; cursor: not-allowed;" disabled>Waiting...</button>
        <button class="login-btn" style="margin-top: 10px; background: rgba(255, 100, 100, 0.5);" onclick="cancelLinking()">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Main Layout -->
  <div id="mainLayout" class="main-layout">
    <!-- Sidebar -->
    <div class="sidebar">
      <div class="sidebar-logo">üé∞ CASINO</div>

      <div class="sidebar-section">
        <div class="sidebar-title">Account</div>
        <button class="game-button" onclick="switchGame('deposit')">üí∞ Deposit</button>
        <button class="game-button" onclick="switchGame('withdraw')">üí≥ Withdraw</button>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Games</div>
        <!-- Coin Flip, Slots, Crash, and Keno removed -->
        <button class="game-button" onclick="switchGame('blackjack')">üÉè Blackjack</button>
        <button class="game-button" onclick="switchGame('plinko')">üéØ Plinko</button>
      </div>

      <div class="sidebar-section">
        <div class="sidebar-title">Social</div>
        <button class="game-button" onclick="switchGame('leaderboard')">üèÜ Leaderboard</button>
      </div>
    </div>

    <!-- Content Wrapper -->
    <div class="content-wrapper">
      <!-- Header -->
      <div class="header">
        <h2 id="userName" style="color: #e2e8f0;"></h2>
        <div class="balance-display">
          <div class="balance-card">
            <div class="balance-label">Balance</div>
            <div class="balance-value" id="userBalance">0</div>
          </div>
          <button class="unlink-btn" id="unlinkBtn" style="display: none;" onclick="unlinkDiscord()">Unlink Discord</button>
          <button class="logout-btn" onclick="logout()">Logout</button>
        </div>
      </div>

      <!-- Message Container -->
      <div id="messageContainer" class="message"></div>

      <!-- Content Area -->
      <div class="content-area">
        <!-- Deposit Section -->
        <div id="deposit" class="game-section active">
          <h2 class="game-title">Deposit Coins</h2>
          <div class="deposit-info">
            <h3 class="deposit-title">üí∞ How to Deposit</h3>
            <p style="color: #cbd5e1; margin: 20px 0;">Send coins to the house account to start gambling</p>
            <div class="house-account">Pay to: <strong>Tomato4444</strong></div>
            <p style="color: #94a3b8; margin-bottom: 20px;">Use this command in Minecraft:</p>
            <div class="command-box">/pay Tomato4444 &lt;amount&gt;</div>
            <p style="color: #94a3b8; margin-top: 20px;">Your deposit will appear instantly in your gambling account!</p>
            <div style="background: rgba(0, 255, 136, 0.1); border: 1px solid #00ff88; padding: 20px; border-radius: 10px; margin-top: 30px;">
              <div style="color: #64748b; font-size: 0.9em; margin-bottom: 10px;">CURRENT BALANCE</div>
              <div style="font-size: 2em; font-weight: bold; color: #00ff88;" id="depositBalance">0</div>
              <div style="color: #64748b; font-size: 0.85em; margin-top: 10px;">coins ready to gamble</div>
            </div>
          </div>
        </div>

        <!-- Coin Flip, Slots, and Keno removed -->

        <!-- Blackjack -->
        <div id="blackjack" class="game-section">
          <style>
            .blackjack-container {
              display: flex;
              flex-direction: column;
              align-items: center;
              background: linear-gradient(145deg, #041e42, #052e20);
              border-radius: 8px;
              padding: 20px;
              color: white;
              font-family: Arial, sans-serif;
              gap: 20px;
            }

            .blackjack-info {
              display: flex;
              justify-content: space-between;
              width: 100%;
              max-width: 500px;
              padding: 15px;
              background: rgba(0, 0, 0, 0.8);
              border-radius: 5px;
              border: 1px solid rgba(77, 166, 255, 0.2);
            }

            .blackjack-balance {
              font-size: 16px;
              font-weight: bold;
              color: #00ff9d;
              text-shadow: 0 0 5px rgba(0, 255, 157, 0.5);
            }

            .blackjack-history {
              max-height: 80px;
              overflow-y: auto;
              flex: 1;
              padding-right: 10px;
              margin-left: 20px;
              font-size: 12px;
            }

            .blackjack-history-item {
              margin: 2px 0;
              padding: 2px 5px;
              border-radius: 3px;
            }

            .blackjack-history-win {
              background-color: rgba(0, 255, 157, 0.2);
              border-left: 3px solid #00ff9d;
              color: #00ff9d;
            }

            .blackjack-history-lose {
              background-color: rgba(255, 42, 109, 0.2);
              border-left: 3px solid #ff2a6d;
              color: #ff2a6d;
            }

            .blackjack-history-push {
              background-color: rgba(77, 166, 255, 0.2);
              border-left: 3px solid #4da6ff;
              color: #4da6ff;
            }

            .blackjack-table {
              display: flex;
              flex-direction: column;
              width: 100%;
              max-width: 600px;
              background: rgba(3, 92, 61, 0.3);
              border-radius: 8px;
              padding: 20px;
              gap: 30px;
            }

            .blackjack-dealer, .blackjack-player {
              display: flex;
              flex-direction: column;
              align-items: center;
              gap: 10px;
            }

            .blackjack-cards {
              display: flex;
              gap: 10px;
              justify-content: center;
              flex-wrap: wrap;
              min-height: 150px;
              align-items: center;
            }

            .blackjack-card {
              width: 100px;
              height: 140px;
              background: white;
              border-radius: 8px;
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: center;
              font-weight: bold;
              font-size: 24px;
              box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            }

            .blackjack-card.red { color: red; }
            .blackjack-card.black { color: black; }

            .blackjack-cardback {
              width: 100px;
              height: 140px;
              background: linear-gradient(135deg, #1a237e 0%, #3949ab 100%);
              border-radius: 8px;
              border: 4px solid #3949ab;
            }

            .blackjack-hand-value {
              font-size: 20px;
              color: white;
              text-shadow: 0 0 5px rgba(255, 255, 255, 0.5);
              font-weight: bold;
              padding: 5px 10px;
              border-radius: 15px;
              background: rgba(0, 0, 0, 0.6);
            }

            .blackjack-controls {
              display: flex;
              justify-content: center;
              gap: 15px;
              flex-wrap: wrap;
              width: 100%;
              max-width: 500px;
            }

            .blackjack-btn {
              padding: 12px 24px;
              border: none;
              border-radius: 5px;
              font-size: 14px;
              font-weight: bold;
              cursor: pointer;
              transition: all 0.2s ease;
              text-transform: uppercase;
              letter-spacing: 1px;
              background: rgba(0, 0, 0, 0.7);
              color: white;
              min-width: 120px;
              text-align: center;
              box-shadow: 0 0 10px rgba(0, 255, 157, 0.3);
            }

            .blackjack-btn:hover:not(:disabled) {
              transform: translateY(-3px);
              box-shadow: 0 0 15px rgba(176, 38, 255, 0.5);
            }

            .blackjack-btn:disabled {
              opacity: 0.5;
              cursor: not-allowed;
            }

            .blackjack-chip {
              width: 50px;
              height: 50px;
              border-radius: 50%;
              display: flex;
              justify-content: center;
              align-items: center;
              color: white;
              font-weight: bold;
              cursor: grab;
              box-shadow: 0 1px 0 rgba(255, 255, 255, 0.5) inset, 0 -1px 0 rgba(0, 0, 0, 0.5) inset, 0 2px 5px rgba(0, 0, 0, 0.3);
              position: relative;
              user-select: none;
              transition: transform 0.2s ease;
            }

            .blackjack-chip:hover { transform: translateY(-3px); }

            .blackjack-chip-500 { background: var(--chip-red, #e53935); }
            .blackjack-chip-1k { background: var(--chip-green, #43a047); }
            .blackjack-chip-5k { background: var(--chip-blue, #1e88e5); }
            .blackjack-chip-100k { background: var(--chip-black, #212121); }
            .blackjack-chip-1m { background: var(--chip-purple, #8e24aa); }

            .blackjack-bet-area {
              width: 120px;
              height: 80px;
              border: 2px dashed rgba(255, 255, 255, 0.3);
              border-radius: 8px;
              display: flex;
              flex-direction: column;
              justify-content: center;
              align-items: center;
              transition: all 0.3s ease;
              position: relative;
            }

            .blackjack-bet-area.highlight {
              border-color: #00ff9d;
              box-shadow: 0 0 15px rgba(0, 255, 157, 0.5);
            }

            .blackjack-message {
              position: fixed;
              top: 50%;
              left: 50%;
              transform: translate(-50%, -50%);
              background: rgba(0, 0, 0, 0.8);
              padding: 20px 40px;
              border-radius: 10px;
              font-size: 28px;
              font-weight: bold;
              color: white;
              text-align: center;
              z-index: 1000;
              opacity: 0;
              transition: opacity 0.3s ease;
              pointer-events: none;
            }

            .blackjack-message.show { opacity: 1; }

            .blackjack-message.win {
              color: #00ff9d;
              text-shadow: 0 0 10px #00ff9d;
            }

            .blackjack-message.lose {
              color: #ff2a6d;
              text-shadow: 0 0 10px #ff2a6d;
            }

            .blackjack-message.push {
              color: #4da6ff;
              text-shadow: 0 0 10px #4da6ff;
            }
          </style>

          <h2 class="game-title">üÉè Blackjack</h2>
          <div class="blackjack-container">
            <div class="blackjack-info">
              <div class="blackjack-balance">Balance: $<span id="blackjackBalance">0</span></div>
              <div class="blackjack-history" id="blackjackHistory"></div>
            </div>

            <div class="blackjack-table">
              <div class="blackjack-dealer">
                <div>Dealer's Hand</div>
                <div class="blackjack-cards" id="blackjackDealerCards"></div>
                <div class="blackjack-hand-value">Total: <span id="blackjackDealerTotal">0</span></div>
              </div>

              <div style="border-top: 1px solid rgba(255, 255, 255, 0.1); padding-top: 20px;">
                <div class="blackjack-player">
                  <div>Your Hand</div>
                  <div class="blackjack-cards" id="blackjackPlayerCards"></div>
                  <div class="blackjack-hand-value">Total: <span id="blackjackPlayerTotal">0</span></div>
                </div>
              </div>
            </div>

            <div id="blackjackSetup">
              <div style="margin-bottom: 20px;">
                <div style="color: #cbd5e1; font-weight: 600; margin-bottom: 15px;">Select Chips to Bet</div>
                <div style="display: flex; gap: 10px; justify-content: center; margin-bottom: 20px; flex-wrap: wrap;">
                  <div class="blackjack-chip blackjack-chip-500" draggable="true" data-chip-value="500">$500</div>
                  <div class="blackjack-chip blackjack-chip-1k" draggable="true" data-chip-value="1000">$1K</div>
                  <div class="blackjack-chip blackjack-chip-5k" draggable="true" data-chip-value="5000">$5K</div>
                  <div class="blackjack-chip blackjack-chip-100k" draggable="true" data-chip-value="100000">$100K</div>
                  <div class="blackjack-chip blackjack-chip-1m" draggable="true" data-chip-value="1000000">$1M</div>
                </div>
              </div>
              <div class="blackjack-bet-area" id="blackjackBetArea">
                <div style="color: #64748b; font-size: 12px;">Drag chips here</div>
                <div style="color: #00ff9d; font-weight: bold; margin-top: 5px;">Bet: $<span id="blackjackBetAmount">0</span></div>
              </div>
              <button class="blackjack-btn" onclick="startBlackjackGame()" style="margin-top: 20px; align-self: center; width: 200px;">üÉè DEAL</button>
            </div>

            <div id="blackjackGameControls" style="display: none;">
              <div class="blackjack-controls">
                <button class="blackjack-btn" id="blackjackHitBtn" onclick="blackjackHit()">Hit</button>
                <button class="blackjack-btn" id="blackjackStandBtn" onclick="blackjackStand()">Stand</button>
                <button class="blackjack-btn" id="blackjackDoubleBtn" onclick="blackjackDouble()">Double</button>
                <button class="blackjack-btn" onclick="resetBlackjackGame()" style="background: rgba(176, 38, 255, 0.3); color: #b026ff;">New Hand</button>
              </div>
            </div>
          </div>

          <div class="blackjack-message" id="blackjackMessage"></div>
        </div>

        <!-- Plinko Game -->
        <div id="plinko" class="game-section">
          <h2 class="game-title">üéØ Plinko</h2>
          <style>
            :root {
              --plinko-bg-primary: #121212;
              --plinko-bg-secondary: #1e1e1e;
              --plinko-bg-tertiary: #2a2a2a;
              --plinko-text-primary: #f5f5f5;
              --plinko-text-secondary: #b3b3b3;
              --plinko-accent-green: #00e676;
              --plinko-accent-red: #ff5252;
              --plinko-accent-blue: #2979ff;
              --plinko-accent-yellow: #ffea00;
              --plinko-accent-orange: #ff9100;
              --plinko-border-radius: 10px;
              --plinko-spacing-sm: 10px;
              --plinko-spacing-md: 15px;
              --plinko-spacing-lg: 20px;
              --plinko-transition-speed: 0.3s;
            }

            .plinko-wrapper {
              display: flex;
              flex-direction: row;
              align-items: flex-start;
              justify-content: center;
              gap: var(--plinko-spacing-lg);
              padding: var(--plinko-spacing-lg);
              width: 100%;
              margin: 0 auto;
              overflow: visible;
              max-width: 1200px;
            }

            .plinko-controls {
              display: flex;
              flex-direction: column;
              gap: var(--plinko-spacing-md);
              padding: var(--plinko-spacing-lg);
              background: var(--plinko-bg-tertiary);
              border-radius: var(--plinko-border-radius);
              width: 200px;
              flex-shrink: 0;
              box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
              border: 1px solid rgba(255, 255, 255, 0.1);
            }

            .plinko-balance {
              font-size: 24px;
              font-weight: bold;
              margin-bottom: var(--plinko-spacing-sm);
              color: var(--plinko-text-primary);
              text-align: center;
              text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
            }

            .plinko-bet-controls {
              display: flex;
              flex-direction: column;
              gap: var(--plinko-spacing-sm);
            }

            .plinko-bet-controls input {
              width: 100%;
              padding: 12px;
              font-size: 16px;
              background-color: var(--plinko-bg-secondary);
              color: var(--plinko-text-primary);
              border: 1px solid rgba(255, 255, 255, 0.2);
              border-radius: var(--plinko-border-radius);
              transition: border-color var(--plinko-transition-speed);
            }

            .plinko-bet-controls input:focus {
              outline: none;
              border-color: var(--plinko-accent-blue);
            }

            .plinko-bet-controls button {
              width: 100%;
              padding: 12px;
              font-size: 16px;
              cursor: pointer;
              border: none;
              border-radius: var(--plinko-border-radius);
              transition: all var(--plinko-transition-speed);
              font-weight: bold;
              color: white;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            }

            .plinko-bet-controls button:hover {
              transform: translateY(-2px);
              box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
            }

            .plinko-bet-controls button:active {
              transform: translateY(1px);
              box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
            }

            .plinko-bet-button {
              background: linear-gradient(135deg, var(--plinko-accent-green), #00c853);
              font-size: 18px;
              margin-top: var(--plinko-spacing-sm);
            }

            .plinko-bet-button:hover {
              background: linear-gradient(135deg, #00c853, var(--plinko-accent-green));
            }

            .plinko-all-in-btn {
              background: linear-gradient(135deg, var(--plinko-accent-red), #d50000);
            }

            .plinko-all-in-btn:hover {
              background: linear-gradient(135deg, #d50000, var(--plinko-accent-red));
            }

            .plinko-half-btn {
              background: linear-gradient(135deg, #ab47bc, #7b1fa2);
            }

            .plinko-half-btn:hover {
              background: linear-gradient(135deg, #7b1fa2, #ab47bc);
            }

            .plinko-double-btn {
              background: linear-gradient(135deg, var(--plinko-accent-blue), #2962ff);
            }

            .plinko-double-btn:hover {
              background: linear-gradient(135deg, #2962ff, var(--plinko-accent-blue));
            }

            .plinko-reset-button {
              padding: 12px 20px;
              font-size: 16px;
              cursor: pointer;
              background: linear-gradient(135deg, #ff7043, #f4511e);
              color: white;
              border: none;
              border-radius: var(--plinko-border-radius);
              transition: all var(--plinko-transition-speed);
              width: 100%;
              font-weight: bold;
              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2);
            }

            .plinko-reset-button:hover {
              background: linear-gradient(135deg, #f4511e, #ff7043);
              transform: translateY(-2px);
              box-shadow: 0 6px 10px rgba(0, 0, 0, 0.3);
            }

            .plinko-reset-button:active {
              transform: translateY(1px);
              box-shadow: 0 2px 3px rgba(0, 0, 0, 0.3);
            }

            .plinko-board {
              position: relative;
              width: 900px;
              height: 750px;
              border: 1px solid rgba(255, 255, 255, 0.1);
              background-color: var(--plinko-bg-secondary);
              border-radius: var(--plinko-border-radius);
              margin-bottom: var(--plinko-spacing-lg);
              box-shadow: 0 10px 20px rgba(0, 0, 0, 0.4);
              overflow: hidden;
              box-sizing: border-box;
            }

            .plinko-peg {
              position: absolute;
              width: 8px;
              height: 8px;
              background-color: rgba(255, 255, 255, 0.6);
              border-radius: 50%;
              transition: all 0.08s ease-out;
              box-shadow: 0 0 5px rgba(255, 255, 255, 0.3);
            }

            .plinko-peg.glow {
              background-color: rgba(255, 215, 0, 0.8);
              box-shadow: 0 0 4px #FFD700, 0 0 8px #FFD700, 0 0 12px rgba(255, 215, 0, 0.8);
              animation: plinko-pulse 0.15s ease-in-out;
            }

            @keyframes plinko-pulse {
              0% {
                background-color: rgba(255, 215, 0, 0.6);
                box-shadow: 0 0 4px #FFD700, 0 0 8px #FFD700, 0 0 12px rgba(255, 215, 0, 0.6);
              }
              50% {
                background-color: rgba(255, 215, 0, 1);
                box-shadow: 0 0 6px #FFD700, 0 0 12px #FFD700, 0 0 18px rgba(255, 215, 0, 1);
              }
              100% {
                background-color: rgba(255, 215, 0, 0.6);
                box-shadow: 0 0 4px #FFD700, 0 0 8px #FFD700, 0 0 12px rgba(255, 215, 0, 0.6);
              }
            }

            .plinko-ball {
              position: absolute;
              width: 14px;
              height: 14px;
              background: radial-gradient(circle at 30% 30%, var(--plinko-accent-red), #c62828);
              border-radius: 50%;
              box-shadow: 0 0 8px rgba(255, 82, 82, 0.7);
            }

            .plinko-multiplier-box {
              position: absolute;
              width: 40px;
              height: 30px;
              display: flex;
              justify-content: center;
              align-items: center;
              font-size: 14px;
              font-weight: bold;
              color: white;
              background: linear-gradient(135deg, #555, #333);
              border: 1px solid rgba(255, 255, 255, 0.2);
              transition: all 0.2s ease;
              border-radius: 5px;
              box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            }

            .plinko-multiplier-box.glow-red {
              box-shadow: 0 0 15px 5px #ff1744, 0 0 25px 8px rgba(255, 23, 68, 0.5);
            }

            .plinko-multiplier-box.glow-yellow {
              box-shadow: 0 0 15px 5px #ffea00, 0 0 25px 8px rgba(255, 234, 0, 0.5);
            }

            .plinko-multiplier-box.glow-orange {
              box-shadow: 0 0 15px 5px #ff9100, 0 0 25px 8px rgba(255, 145, 0, 0.5);
            }

            .plinko-multiplier-box.glow-black {
              box-shadow: 0 0 20px 8px rgba(255, 255, 255, 0.8), 0 0 30px 15px rgba(255, 255, 255, 0.5);
            }

            .plinko-results {
              width: 200px;
              height: 750px;
              overflow-y: auto;
              border: 1px solid rgba(255, 255, 255, 0.1);
              padding: var(--plinko-spacing-md);
              background-color: var(--plinko-bg-tertiary);
              border-radius: var(--plinko-border-radius);
              box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);
              flex-shrink: 0;
              scrollbar-width: thin;
              scrollbar-color: var(--plinko-bg-tertiary) var(--plinko-bg-secondary);
            }

            .plinko-results::-webkit-scrollbar {
              width: 8px;
            }

            .plinko-results::-webkit-scrollbar-track {
              background: var(--plinko-bg-secondary);
              border-radius: 4px;
            }

            .plinko-results::-webkit-scrollbar-thumb {
              background-color: var(--plinko-bg-tertiary);
              border-radius: 4px;
              border: 2px solid var(--plinko-bg-secondary);
            }

            .plinko-result-item {
              margin-bottom: var(--plinko-spacing-sm);
              background-color: var(--plinko-bg-secondary);
              color: var(--plinko-text-primary);
              padding: 8px 12px;
              font-weight: bold;
              border-radius: 5px;
              box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
              border-left: 3px solid #555;
            }

            .plinko-result-item.red {
              color: var(--plinko-accent-red);
              border-left-color: var(--plinko-accent-red);
            }

            .plinko-result-item.yellow {
              color: var(--plinko-accent-yellow);
              border-left-color: var(--plinko-accent-yellow);
            }

            .plinko-result-item.orange {
              color: var(--plinko-accent-orange);
              border-left-color: var(--plinko-accent-orange);
            }

            .plinko-result-item.rainbow-win {
              animation: plinko-rainbow-text 2s linear infinite;
              text-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
              font-size: 1.2em;
              border-left-color: white;
            }

            @keyframes plinko-rainbow-text {
              0% { color: #ff0000; }
              17% { color: #ff00ff; }
              33% { color: #0000ff; }
              50% { color: #00ffff; }
              67% { color: #00ff00; }
              83% { color: #ffff00; }
              100% { color: #ff0000; }
            }

            .plinko-max-win-container {
              text-align: center;
              margin-top: var(--plinko-spacing-sm);
              font-size: 28px;
              font-weight: bold;
              color: var(--plinko-accent-green);
              text-shadow: 0 0 5px rgba(0, 230, 118, 0.5);
              opacity: 0;
              transition: opacity 0.3s ease;
              margin-bottom: var(--plinko-spacing-md);
            }

            .plinko-max-win-container.visible {
              opacity: 1;
            }

            .plinko-graph-container {
              width: 900px;
              height: 100px;
              position: relative;
              overflow: hidden;
              background-color: var(--plinko-bg-secondary);
              border-radius: var(--plinko-border-radius);
              margin-bottom: var(--plinko-spacing-lg);
              border: 1px solid rgba(255, 255, 255, 0.1);
              box-shadow: 0 6px 12px rgba(0, 0, 0, 0.3);
            }

            .plinko-graph-bar {
              position: absolute;
              bottom: 0;
              width: 6px;
              transition: height 0.5s;
            }

            .plinko-graph-content {
              position: absolute;
              height: 100%;
              display: flex;
              flex-direction: row;
              transition: transform 0.3s;
            }

            .plinko-game-container {
              display: flex;
              flex-direction: column;
              align-items: center;
              justify-content: flex-start;
              width: 900px;
              flex-shrink: 0;
            }
          </style>
          <div class="plinko-wrapper">
            <div class="plinko-controls">
              <div class="plinko-balance">Balance: $<span id="plinkoBalance">0</span></div>
              <div class="plinko-bet-controls">
                <input type="text" id="plinkoBetAmount" value="100" min="1" oninput="formatPlinkoInput(this)" placeholder="Bet amount">
                <button onclick="halvePlinkoBet()" class="plinko-half-btn">1/2</button>
                <button onclick="doublePlinkoBet()" class="plinko-double-btn">2x</button>
                <button onclick="allInPlinko()" class="plinko-all-in-btn">ALL IN</button>
                <button onmousedown="startPlinkoAutoBet()" onmouseup="stopPlinkoAutoBet()" onmouseleave="stopPlinkoAutoBet()" class="plinko-bet-button">PLACE BET</button>
              </div>
              <!-- Reset button removed per request -->
            </div>
            <div class="plinko-game-container">
              <div class="plinko-graph-container" id="plinkoGraphContainer"></div>
              <div class="plinko-board" id="plinkoBoard"></div>
              <div id="plinkoMaxWin" class="plinko-max-win-container"></div>
            </div>
            <div class="plinko-results" id="plinkoResults"></div>
          </div>
        </div>
        </div>

        <!-- Mines removed -->

        <!-- Crash Game -->
        <!-- Crash removed -->

        <!-- Towers Game -->
        <!-- Leaderboard -->
        <div id="leaderboard" class="game-section">
          <h2 class="game-title">üèÜ Leaderboard</h2>
          <div style="max-width: 600px; margin: 0 auto;">
            <div id="leaderboardList" style="display: grid; gap: 15px;">
              <div style="text-align: center; color: #64748b;">Loading...</div>
            </div>
          </div>
        </div>

        <!-- Withdraw -->
        <div id="withdraw" class="game-section">
          <h2 class="game-title">üí≥ Withdraw Winnings</h2>
          <div class="game-grid">
            <div class="game-card">
              <div class="game-info">
                <h3>Cash Out Your Balance</h3>
                <p style="color: #cbd5e1; margin: 15px 0;">Your coins will be sent to your Minecraft account via /pay</p>
                <div class="form-group">
                  <label class="form-label">Withdraw Amount</label>
                  <input type="number" id="withdrawAmount" class="form-input" placeholder="Enter amount" min="1" step="1">
                  <small style="color: #64748b; margin-top: 5px; display: block;">Available: <span id="withdrawBalance">0</span> coins</small>
                </div>
                <button class="play-btn" onclick="withdraw()">Withdraw</button>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Result Modal -->
  <div id="resultModal" class="result-modal">
    <div class="result-content">
      <div class="result-title" id="resultTitle"></div>
      <div class="result-details" id="resultDetails"></div>
      <div class="modal-buttons">
        <button onclick="closeResult()">Play Again</button>
      </div>
    </div>
  </div>

  <script>
    const API_URL = '/api';
    let currentUser = null;
    let selectedChoice = null;
    let selectedNumber = null;
    let lastBalance = 0;
    let pendingLinkingCode = null;
    let linkingPollInterval = null;

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      checkLogin();
      checkOAuthCallback();
    });

    // Check for Discord OAuth callback
    function checkOAuthCallback() {
      const params = new URLSearchParams(window.location.search);
      
      // Check for already linked Discord account
      if (params.has('discord_login')) {
        const username = params.get('user');
        console.log('Discord login detected for user:', username);
        if (username) {
          localStorage.setItem('currentUser', JSON.stringify({ username }));
          loadUser(username);
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }
      }
      
      // Check for new Discord linking
      if (params.has('discordId')) {
        const discordId = params.get('discordId');
        const discordTag = params.get('discordTag');
        const linkingCode = params.get('linkingCode');
        
        console.log('Discord linking detected:', { discordId, discordTag, linkingCode });
        
        if (linkingCode) {
          pendingLinkingCode = linkingCode;
          showLinkingScreen(linkingCode);
          startLinkingPoll(linkingCode, discordId, discordTag);
          // Clean up URL
          window.history.replaceState({}, document.title, window.location.pathname);
          return;
        }
      }
      
      // Check for error
      if (params.has('error')) {
        const error = params.get('error');
        console.error('OAuth error:', error);
        showMessage(`Authorization failed: ${error}`, 'error');
        window.history.replaceState({}, document.title, window.location.pathname);
      }
    }

    function showLinkingScreen(code) {
      document.getElementById('discordLoginSection').style.display = 'none';
      document.getElementById('usernameLoginSection').style.display = 'none';
      document.getElementById('linkingSection').style.display = 'block';
      document.getElementById('linkingCode').textContent = code;
      document.getElementById('loginMessage').textContent = 'Connect Your Accounts';
    }

    function startLinkingPoll(code, discordId, discordTag) {
      clearInterval(linkingPollInterval);
      linkingPollInterval = setInterval(() => {
        checkLinkingStatus(code, discordId, discordTag);
      }, 2000);
    }

    async function checkLinkingStatus(code, discordId, discordTag) {
      try {
        const response = await fetch(`${API_URL}/pending-links`);
        const result = await response.json();
        
        // Check if linking code is still pending (not verified yet)
        if (!result.pending || !result.pending[code]) {
          // Code was used/verified, try to login with Discord
          clearInterval(linkingPollInterval);
          const loginResponse = await fetch(`${API_URL}/discord-login`, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ discordId, discordTag })
          });
          
          if (loginResponse.ok) {
            const loginResult = await loginResponse.json();
            if (loginResult.user) {
              localStorage.setItem('currentUser', JSON.stringify(loginResult.user));
              loadUser(loginResult.user.username);
            }
          }
        }
      } catch (error) {
        console.log('Checking linking status...');
      }
    }

    function cancelLinking() {
      clearInterval(linkingPollInterval);
      pendingLinkingCode = null;
      document.getElementById('discordLoginSection').style.display = 'block';
      document.getElementById('usernameLoginSection').style.display = 'block';
      document.getElementById('linkingSection').style.display = 'none';
      document.getElementById('loginMessage').textContent = 'Secure Account Access';
    }

    function loginWithDiscord() {
      window.location.href = `${API_URL}/discord/auth`;
    }

    function checkLogin() {
      const user = localStorage.getItem('currentUser');
      if (user) {
        loadUser(JSON.parse(user).username);
      }
    }

    async function login() {
      console.log('Login button clicked');
      const username = document.getElementById('loginUsername').value.trim();
      console.log('Username:', username);
      
      if (!username) {
        showMessage('Please enter a username', 'error');
        return;
      }

      try {
        console.log('Sending login request to:', `${API_URL}/register`);
        const response = await fetch(`${API_URL}/register`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username })
        });
        console.log('Response status:', response.status);
        const result = await response.json();
        console.log('Response data:', result);
        
        if (response.ok && result.user) {
          console.log('Login successful, loading user...');
          localStorage.setItem('currentUser', JSON.stringify(result.user));
          loadUser(username);
        } else {
          showMessage(result.error || 'Login failed', 'error');
        }
      } catch (error) {
        console.error('Login error:', error);
        showMessage('Login failed: ' + error.message, 'error');
      }
    }

    async function loadUser(username) {
      console.log('Loading user:', username);
      try {
        const currentUrl = `${API_URL}/user/${username}`;
        console.log('Fetching user from:', currentUrl);
        
        const response = await fetch(currentUrl);
        console.log('User fetch response status:', response.status);
        
        const result = await response.json();
        console.log('User data:', result);
        
        if (response.ok && result.user) {
          console.log('User loaded successfully');
          currentUser = result.user;
          lastBalance = currentUser.balance;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          document.getElementById('loginScreen').style.display = 'none';
          document.getElementById('mainLayout').classList.add('active');
          document.getElementById('userName').textContent = `üë§ ${currentUser.username}`;
          
          // Show unlink button if Discord is linked
          if (currentUser.discordId) {
            document.getElementById('unlinkBtn').style.display = 'block';
          } else {
            document.getElementById('unlinkBtn').style.display = 'none';
          }
          
          updateBalance();
          switchGame('deposit');
          loadLeaderboard();
          initBlackjack();
          initPlinko();
          setInterval(checkForDeposits, 3000);
          setInterval(loadLeaderboard, 10000);
        } else {
          showMessage(result.error || 'Failed to load user', 'error');
        }
      } catch (error) {
        console.error('Load user error:', error);
        showMessage('Failed to load user: ' + error.message, 'error');
      }
    }

    async function checkForDeposits() {
      if (!currentUser) return;
      try {
        const response = await fetch(`${API_URL}/user/${currentUser.username}`);
        const result = await response.json();
        if (response.ok && result.user) {
          currentUser = result.user;
          if (currentUser.balance > lastBalance) {
            showMessage(`‚úÖ Deposit received! +${currentUser.balance - lastBalance} coins added to your account!`, 'success');
            lastBalance = currentUser.balance;
          }
          updateBalance();
        }
      } catch (error) {}
    }

    function updateBalance() {
      document.getElementById('userBalance').textContent = currentUser.balance || 0;
      document.getElementById('depositBalance').textContent = currentUser.balance || 0;
      document.getElementById('withdrawBalance').textContent = currentUser.balance || 0;
      if (document.getElementById('blackjackBalance')) {
        document.getElementById('blackjackBalance').textContent = currentUser.balance || 0;
      }
      // Keep Plinko display in sync with the user's actual balance when Plinko is idle
      try {
        if (typeof plinkoBalance !== 'undefined' && document.getElementById('plinkoBalance')) {
          const plinkoIdle = !plinkoAutoBetInterval && (!plinkoBalls || plinkoBalls.length === 0);
          if (plinkoIdle) {
            plinkoBalance = currentUser.balance || 0;
            plinkoBalanceHistory = [plinkoBalance];
            updatePlinkoBalance();
            savePlinkoSession();
          }
        }
      } catch (e) { /* ignore if plinko not initialized yet */ }
    }

    function switchGame(game) {
      document.querySelectorAll('.game-section').forEach(s => s.classList.remove('active'));
      const gameElement = document.getElementById(game);
      if (gameElement) gameElement.classList.add('active');
    }

    // Slots and Keno/Number removed

    // BLACKJACK GAME
    // ADVANCED BLACKJACK WITH CHIP BETTING
    let blackjackState = {
      deck: [],
      dealerHand: [],
      playerHand: [],
      bet: 0,
      gameInProgress: false,
      dealersTurn: false,
      handOver: false
    };

    // Card Definitions
    const suits = ['‚ô•', '‚ô¶', '‚ô†', '‚ô£'];
    const values = ['2', '3', '4', '5', '6', '7', '8', '9', '10', 'J', 'Q', 'K', 'A'];

    function createNewDeck() {
      blackjackState.deck = [];
      for (const suit of suits) {
        for (const value of values) {
          blackjackState.deck.push({ suit, value });
        }
      }
    }

    function shuffleDeck() {
      for (let i = blackjackState.deck.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [blackjackState.deck[i], blackjackState.deck[j]] = [blackjackState.deck[j], blackjackState.deck[i]];
      }
    }

    function calculateHandValue(hand, hideFirstCard = false) {
      if (hand.length === 0) return 0;
      let handCopy = [...hand];
      if (hideFirstCard) handCopy = handCopy.slice(1);
      
      let value = 0;
      let aces = 0;
      
      for (const card of handCopy) {
        if (card.value === 'A') {
          aces++;
          value += 11;
        } else if (['K', 'Q', 'J'].includes(card.value)) {
          value += 10;
        } else {
          value += parseInt(card.value);
        }
      }
      
      while (value > 21 && aces > 0) {
        value -= 10;
        aces--;
      }
      
      return value;
    }

    function dealCard(hand, element, faceUp = true) {
      if (blackjackState.deck.length === 0) {
        createNewDeck();
        shuffleDeck();
      }
      
      const card = blackjackState.deck.pop();
      hand.push(card);
      renderCard(card, element, faceUp);
      
      if (element === document.getElementById('blackjackPlayerCards')) {
        document.getElementById('blackjackPlayerTotal').textContent = calculateHandValue(blackjackState.playerHand);
      } else if (blackjackState.dealersTurn) {
        document.getElementById('blackjackDealerTotal').textContent = calculateHandValue(blackjackState.dealerHand);
      }
    }

    function renderCard(card, element, faceUp = true) {
      const cardElement = document.createElement('div');
      cardElement.classList.add('blackjack-card');
      
      if (!faceUp) {
        cardElement.classList.add('hidden');
        cardElement.innerHTML = '<div class="blackjack-cardback"></div>';
      } else {
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        cardElement.classList.add(isRed ? 'red' : 'black');
        cardElement.textContent = card.value + card.suit;
      }
      
      element.appendChild(cardElement);
    }

    function updateBlackjackDisplay() {
      document.getElementById('blackjackBalance').textContent = currentUser.balance;
    }

    function showBlackjackMessage(text, type) {
      const messageEl = document.getElementById('blackjackMessage');
      messageEl.textContent = text;
      messageEl.className = 'blackjack-message show ' + type;
      
      setTimeout(() => {
        messageEl.classList.remove('show');
      }, 2000);
    }

    function addBlackjackHistory(text, type) {
      const item = document.createElement('div');
      item.classList.add('blackjack-history-item', 'blackjack-history-' + type);
      item.textContent = text;
      
      const history = document.getElementById('blackjackHistory');
      history.insertBefore(item, history.firstChild);
      
      while (history.children.length > 10) {
        history.removeChild(history.lastChild);
      }
    }

    // Chip betting setup
    function setupBlackjackChips() {
      let blackjackBetDrag = null;
      
      document.querySelectorAll('[data-chip-value]').forEach(chip => {
        chip.addEventListener('dragstart', (e) => {
          if (blackjackState.gameInProgress) return false;
          blackjackBetDrag = parseInt(chip.dataset.chipValue);
          e.dataTransfer.setData('text/plain', blackjackBetDrag);
          chip.classList.add('dragging');
        });
        
        chip.addEventListener('dragend', () => {
          chip.classList.remove('dragging');
        });
      });
      
      const betArea = document.getElementById('blackjackBetArea');
      
      betArea.addEventListener('dragover', (e) => {
        if (blackjackState.gameInProgress) return;
        e.preventDefault();
        betArea.classList.add('highlight');
      });
      
      betArea.addEventListener('dragleave', () => {
        betArea.classList.remove('highlight');
      });
      
      betArea.addEventListener('drop', (e) => {
        if (blackjackState.gameInProgress) return;
        e.preventDefault();
        betArea.classList.remove('highlight');
        
        const chipValue = parseInt(e.dataTransfer.getData('text/plain'));
        
        if (chipValue <= currentUser.balance) {
          blackjackState.bet += chipValue;
          document.getElementById('blackjackBetAmount').textContent = blackjackState.bet;
        } else {
          showBlackjackMessage('Not enough balance!', 'lose');
        }
      });
    }

    function startBlackjackGame() {
      if (blackjackState.bet <= 0) {
        showBlackjackMessage('Place your bet first!', 'lose');
        return;
      }
      
      if (blackjackState.bet > currentUser.balance) {
        showBlackjackMessage('Insufficient balance!', 'lose');
        return;
      }

      // Clear cards
      document.getElementById('blackjackDealerCards').innerHTML = '';
      document.getElementById('blackjackPlayerCards').innerHTML = '';

      // Initialize game state
      blackjackState.gameInProgress = true;
      blackjackState.dealerHand = [];
      blackjackState.playerHand = [];
      blackjackState.dealersTurn = false;
      blackjackState.handOver = false;

      // Setup game
      if (blackjackState.deck.length === 0) {
        createNewDeck();
        shuffleDeck();
      }

      // Deal initial cards
      dealCard(blackjackState.playerHand, document.getElementById('blackjackPlayerCards'), true);
      dealCard(blackjackState.dealerHand, document.getElementById('blackjackDealerCards'), true);
      dealCard(blackjackState.playerHand, document.getElementById('blackjackPlayerCards'), true);
      dealCard(blackjackState.dealerHand, document.getElementById('blackjackDealerCards'), false);

      document.getElementById('blackjackSetup').style.display = 'none';
      document.getElementById('blackjackGameControls').style.display = 'block';
      document.getElementById('blackjackDealerTotal').textContent = '?';

      // Check for natural blackjack
      if (calculateHandValue(blackjackState.playerHand) === 21) {
        setTimeout(() => { dealerPlayBlackjack(); }, 1000);
      }

      updateBlackjackControls();
    }

    function blackjackHit() {
      if (blackjackState.gameInProgress) {
        dealCard(blackjackState.playerHand, document.getElementById('blackjackPlayerCards'), true);
        
        if (calculateHandValue(blackjackState.playerHand) > 21) {
          blackjackState.handOver = true;
          showBlackjackResult();
        }
        updateBlackjackControls();
      }
    }

    function blackjackStand() {
      blackjackState.dealersTurn = true;
      dealerPlayBlackjack();
    }

    function blackjackDouble() {
      if (currentUser.balance < blackjackState.bet) {
        showBlackjackMessage('Not enough balance to double!', 'lose');
        return;
      }
      
      blackjackState.bet *= 2;
      
      dealCard(blackjackState.playerHand, document.getElementById('blackjackPlayerCards'), true);
      
      if (calculateHandValue(blackjackState.playerHand) > 21) {
        blackjackState.handOver = true;
        showBlackjackResult();
      } else {
        blackjackState.dealersTurn = true;
        dealerPlayBlackjack();
      }
    }

    function dealerPlayBlackjack() {
      // Reveal dealer's hidden card
      const dealerCards = document.getElementById('blackjackDealerCards').querySelectorAll('.blackjack-card');
      if (dealerCards[1] && dealerCards[1].classList.contains('hidden')) {
        dealerCards[1].classList.remove('hidden');
        dealerCards[1].classList.add('red', 'black');
        const card = blackjackState.dealerHand[1];
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        dealerCards[1].textContent = card.value + card.suit;
        dealerCards[1].classList.remove('red', 'black');
        dealerCards[1].classList.add(isRed ? 'red' : 'black');
      }

      document.getElementById('blackjackDealerTotal').textContent = calculateHandValue(blackjackState.dealerHand);

      // Dealer draws until 17+
      const dealerDraw = () => {
        const dealerValue = calculateHandValue(blackjackState.dealerHand);
        
        if (dealerValue < 17) {
          setTimeout(() => {
            dealCard(blackjackState.dealerHand, document.getElementById('blackjackDealerCards'), true);
            dealerDraw();
          }, 700);
        } else {
          blackjackState.handOver = true;
          showBlackjackResult();
        }
      };

      setTimeout(() => {
        dealerDraw();
      }, 700);
    }

    function showBlackjackResult() {
      const playerValue = calculateHandValue(blackjackState.playerHand);
      const dealerValue = calculateHandValue(blackjackState.dealerHand);
      
      let result = '';
      let won = false;
      let messageType = 'push';

      if (playerValue > 21) {
        result = 'Player Bust!';
        messageType = 'lose';
        addBlackjackHistory(`Bust with ${playerValue}`, 'lose');
      } else if (dealerValue > 21) {
        result = 'Dealer Bust! You Win!';
        won = true;
        messageType = 'win';
        addBlackjackHistory(`Won vs bust (${playerValue})`, 'win');
      } else if (playerValue > dealerValue) {
        result = 'You Win!';
        won = true;
        messageType = 'win';
        addBlackjackHistory(`Won ${playerValue} vs ${dealerValue}`, 'win');
      } else if (playerValue < dealerValue) {
        result = 'Dealer Wins!';
        messageType = 'lose';
        addBlackjackHistory(`Lost ${playerValue} vs ${dealerValue}`, 'lose');
      } else {
        result = 'Push!';
        won = false;
        messageType = 'push';
        addBlackjackHistory(`Push at ${playerValue}`, 'push');
      }

      // Send result to server
      sendBlackjackResult(won, dealerValue, playerValue, result, messageType);
    }

    async function sendBlackjackResult(won, dealerValue, playerValue, result, messageType) {
      try {
        const response = await fetch(`${API_URL}/games/blackjack`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({
            username: currentUser.username,
            wager: blackjackState.bet,
            won: won || false,
            dealerValue,
            playerValue
          })
        });
        const result_data = await response.json();
        
        if (response.ok) {
          currentUser = result_data.user;
          lastBalance = currentUser.balance;
          updateBalance();
          updateBlackjackDisplay();

          showBlackjackMessage(result, messageType);

          setTimeout(() => {
            resetBlackjackGame();
          }, 2000);
        } else {
          showBlackjackMessage('Error saving game', 'lose');
          resetBlackjackGame();
        }
      } catch (error) {
        console.error('Error:', error);
        showBlackjackMessage('Error saving game', 'lose');
        resetBlackjackGame();
      }
    }

    function updateBlackjackControls() {
      const playerValue = calculateHandValue(blackjackState.playerHand);
      
      document.getElementById('blackjackHitBtn').disabled = playerValue > 21 || blackjackState.dealersTurn;
      document.getElementById('blackjackStandBtn').disabled = blackjackState.dealersTurn;
      document.getElementById('blackjackDoubleBtn').disabled = blackjackState.playerHand.length !== 2 || blackjackState.dealersTurn || currentUser.balance < blackjackState.bet;
    }

    function resetBlackjackGame() {
      blackjackState.bet = 0;
      blackjackState.gameInProgress = false;
      blackjackState.dealersTurn = false;
      blackjackState.handOver = false;
      blackjackState.dealerHand = [];
      blackjackState.playerHand = [];

      document.getElementById('blackjackSetup').style.display = 'block';
      document.getElementById('blackjackGameControls').style.display = 'none';
      document.getElementById('blackjackBetAmount').textContent = '0';
      document.getElementById('blackjackDealerCards').innerHTML = '';
      document.getElementById('blackjackPlayerCards').innerHTML = '';
      document.getElementById('blackjackDealerTotal').textContent = '0';
      document.getElementById('blackjackPlayerTotal').textContent = '0';
    }

    // Initialize Blackjack on page load
    function initBlackjack() {
      updateBlackjackDisplay();
      setupBlackjackChips();
      createNewDeck();
      shuffleDeck();
    }

    // ============ PLINKO GAME ============
    // Plinko Game state variables
    let plinkoBalance = 1000;
    const plinkoMultipliers = [1000, 130, 26, 9, 4, 2, 0.2, 0.2, 0.2, 0.2, 0.2, 2, 4, 9, 26, 130, 1000];
    const plinkoPegRows = 16;
    const plinkoPegSpacing = 40;
    const plinkoBallSize = 14;
    const plinkoGravity = 0.11;
    const plinkoBounceDamping = 0.7;
    const plinkoBoard = document.getElementById('plinkoBoard');
    const plinkoResultsDiv = document.getElementById('plinkoResults');
    const plinkoGraphContainer = document.getElementById('plinkoGraphContainer');
    let plinkoBalls = [];
    let plinkoPegs = [];
    let plinkoBalanceHistory = [plinkoBalance];
    let plinkoMaxWin = 0;
    let plinkoMessageQueue = [];
    let plinkoIsShowingMessage = false;
    let plinkoMessageCooldowns = new Map();
    let plinkoAutoBetInterval = null;
    let plinkoCurrentBetDelay = 150;
    const PLINKO_MIN_BET_DELAY = 50;
    const PLINKO_ACCELERATION_RATE = 10;

    function initPlinko() {
      plinkoBalance = currentUser.balance;
      document.getElementById('plinkoBalance').textContent = plinkoBalance.toLocaleString();
      plinkoBalanceHistory = [plinkoBalance];
      createPlinkoPegs();
      createPlinkoMultiplierBoxes();
      // Attempt to restore a previous Plinko session (if user refreshed mid-session)
      loadPlinkoSession();
    }

    function createPlinkoPegs() {
      if (plinkoBoard.querySelectorAll('.plinko-peg').length > 0) return; // Already created

      for (let row = 1; row <= plinkoPegRows; row++) {
        for (let col = 0; col < row; col++) {
          const peg = document.createElement('div');
          peg.className = 'plinko-peg';
          peg.style.left = `${(plinkoBoard.offsetWidth / 2) - (row * plinkoPegSpacing / 2) + col * plinkoPegSpacing + 475}px`;
          peg.style.top = `${row * plinkoPegSpacing}px`;
          plinkoBoard.appendChild(peg);
          plinkoPegs.push(peg);
        }
      }
    }

    function createPlinkoMultiplierBoxes() {
      const boxHeight = 30;
      const boxWidth = 40;
      const boxSpacing = plinkoPegSpacing;
      const lastRowY = plinkoPegRows * plinkoPegSpacing;
      const boxY = lastRowY + 20;

      for (let i = 0; i < plinkoMultipliers.length; i++) {
        const box = document.createElement('div');
        box.className = 'plinko-multiplier-box';
        box.textContent = `${plinkoMultipliers[i]}x`;

        const totalWidth = plinkoMultipliers.length * boxSpacing;
        const startX = (plinkoBoard.offsetWidth - totalWidth) / 2 + 460;
        box.style.left = `${startX + (i * boxSpacing)}px`;
        box.style.top = `${boxY}px`;

        if (plinkoMultipliers[i] === 1000) {
          box.style.background = 'linear-gradient(135deg, #ff1744, #d50000)';
          box.dataset.glowClass = 'glow-red';
        } else if (plinkoMultipliers[i] === 0.2) {
          box.style.background = 'linear-gradient(135deg, #ffea00, #ffd600)';
          box.style.color = 'black';
          box.dataset.glowClass = 'glow-yellow';
        } else if (plinkoMultipliers[i] === 130 || plinkoMultipliers[i] === 2) {
          box.style.background = 'linear-gradient(135deg, #ff9100, #ff6d00)';
          box.dataset.glowClass = 'glow-orange';
        } else {
          box.style.background = 'linear-gradient(135deg, #424242, #212121)';
          box.dataset.glowClass = 'glow-black';
        }

        plinkoBoard.appendChild(box);
      }
    }

    function updatePlinkoBalance() {
      document.getElementById('plinkoBalance').textContent = plinkoBalance.toLocaleString();
      plinkoBalanceHistory.push(plinkoBalance);
      updatePlinkoGraph();
    }

    function formatPlinkoBet(value) {
      return value >= 1000 ? value.toLocaleString() : value.toString();
    }

    function formatPlinkoInput(input) {
      const value = parseInt(input.value.replace(/,/g, ''));
      if (!isNaN(value) && value >= 1000) {
        input.value = value.toLocaleString();
      }
    }

    function halvePlinkoBet() {
      const betInput = document.getElementById('plinkoBetAmount');
      const currentBet = parseInt(betInput.value.replace(/,/g, ''));
      const newBet = Math.max(1, Math.floor(currentBet / 2));
      betInput.value = newBet.toLocaleString();
    }

    function doublePlinkoBet() {
      const betInput = document.getElementById('plinkoBetAmount');
      const currentBet = parseInt(betInput.value.replace(/,/g, ''));
      const newBet = Math.min(plinkoBalance, currentBet * 2);
      betInput.value = newBet.toLocaleString();
    }

    function applyPlinkoPegGlow(peg) {
      peg.classList.remove('glow');
      void peg.offsetWidth;
      peg.classList.add('glow');
      setTimeout(() => peg.classList.remove('glow'), 150);
    }

    function applyPlinkoMultiplierGlow(box) {
      box.classList.remove('glow-red', 'glow-yellow', 'glow-orange', 'glow-black');
      box.classList.add(box.dataset.glowClass);
      setTimeout(() => {
        box.classList.remove(box.dataset.glowClass);
      }, 500);
    }

    function updatePlinkoGraph() {
      let graphContent = plinkoGraphContainer.querySelector('.plinko-graph-content');
      if (!graphContent) {
        graphContent = document.createElement('div');
        graphContent.className = 'plinko-graph-content';
        plinkoGraphContainer.appendChild(graphContent);
      }

      graphContent.innerHTML = '';

      const minBalance = Math.min(...plinkoBalanceHistory);
      const maxBalance = Math.max(...plinkoBalanceHistory);
      const range = maxBalance - minBalance || 1;

      const barWidth = 6;
      const barSpacing = 2;
      const totalBarWidth = barWidth + barSpacing;
      const maxBars = Math.floor(plinkoGraphContainer.offsetWidth / totalBarWidth);

      const recentHistory = plinkoBalanceHistory.slice(-maxBars);

      recentHistory.forEach((value, index) => {
        const bar = document.createElement('div');
        bar.className = 'plinko-graph-bar';
        bar.style.left = `${index * totalBarWidth}px`;

        const heightPercentage = ((value - minBalance) / range) * 100;
        bar.style.height = `${Math.max(2, heightPercentage)}px`;

        if (value >= 1000) {
          bar.style.background = 'linear-gradient(to top, #00e676, #00c853)';
        } else {
          bar.style.background = 'linear-gradient(to top, #ff5252, #d50000)';
        }

        graphContent.appendChild(bar);
      });

      graphContent.style.transform = `translateX(${Math.max(0, plinkoGraphContainer.offsetWidth - (recentHistory.length * totalBarWidth))}px)`;
    }

    // Persist and restore Plinko session so refreshes return to the same state
    function savePlinkoSession() {
      try {
        const key = `plinkoSession_${currentUser ? currentUser.username : 'guest'}`;
        const session = {
          balance: plinkoBalance,
          balanceHistory: plinkoBalanceHistory,
          maxWin: plinkoMaxWin,
          resultsHTML: plinkoResultsDiv.innerHTML,
          betInput: (document.getElementById('plinkoBetAmount') || {}).value || '',
          autoBet: !!plinkoAutoBetInterval,
          pendingBet: plinkoBalls.length > 0
        };
        localStorage.setItem(key, JSON.stringify(session));
      } catch (e) { console.error('Failed to save plinko session', e); }
    }

    function loadPlinkoSession() {
      try {
        const key = `plinkoSession_${currentUser ? currentUser.username : 'guest'}`;
        const raw = localStorage.getItem(key);
        if (!raw) return;
        const session = JSON.parse(raw);
        if (!session) return;
        // Restore balance and UI state
        if (typeof session.balance === 'number') plinkoBalance = session.balance;
        if (Array.isArray(session.balanceHistory)) plinkoBalanceHistory = session.balanceHistory;
        if (typeof session.maxWin === 'number') plinkoMaxWin = session.maxWin;
        if (session.resultsHTML) plinkoResultsDiv.innerHTML = session.resultsHTML;
        const betInput = document.getElementById('plinkoBetAmount');
        if (betInput && session.betInput) betInput.value = session.betInput;
        updatePlinkoBalance();
        updatePlinkoGraph();
        updatePlinkoMaxWinDisplay();
        // If auto-bet was active before refresh, restart it (user resumes clicking to hold)
        if (session.autoBet) {
          // slight delay to allow UI init
          setTimeout(() => {
            startPlinkoAutoBet();
          }, 200);
        }
      } catch (e) { console.error('Failed to load plinko session', e); }
    }

    function plinkoBet() {
      const betInput = document.getElementById('plinkoBetAmount');
      const betAmount = parseInt(betInput.value.replace(/,/g, ''));

      if (isNaN(betAmount) || betAmount > plinkoBalance || betAmount < 1) {
        alert('Invalid bet amount!');
        stopPlinkoAutoBet();
        return;
      }

      // Mark session as pending so refresh will warn and restore
      plinkoBalance -= betAmount;
      updatePlinkoBalance();
      savePlinkoSession();

      createPlinkoBall(betAmount);
    }

    function createPlinkoBall(betAmount) {
      const ball = document.createElement('div');
      ball.className = 'plinko-ball';
      ball.style.left = `${plinkoBoard.offsetWidth / 2 - plinkoBallSize / 2 + 10}px`;
      ball.style.top = `0px`;
      ball.dataset.betAmount = betAmount.toString();
      plinkoBoard.appendChild(ball);
      plinkoBalls.push(ball);

      let velocityY = 0;
      let velocityX = (Math.random() - 0.5) * 2;

      animatePlinkoBall(ball, velocityX, velocityY, betAmount);
      savePlinkoSession();
    }

    function animatePlinkoBall(ball, velocityX, velocityY, betAmount) {
      function dropBall() {
        const centerBias = 0.001;
        const centerRegion = plinkoBoard.offsetWidth * 0.2;
        const boardCenter = (plinkoBoard.offsetWidth / 2) + 60;
        const distanceFromCenter = Math.abs(parseFloat(ball.style.left) - boardCenter);

        if (distanceFromCenter < centerRegion) {
          const biasStrength = (centerRegion - distanceFromCenter) / centerRegion * 0.3;
          const bias = (parseFloat(ball.style.left) < boardCenter) ? centerBias : -centerBias;
          velocityX += bias * biasStrength;
        }

        velocityX += (Math.random() - 0.5) * 0.015;
        velocityY += plinkoGravity;

        let newTop = parseFloat(ball.style.top) + velocityY;
        let newLeft = parseFloat(ball.style.left) + velocityX;

        plinkoBalls.forEach(otherBall => {
          if (otherBall !== ball) {
            const dx = newLeft - parseFloat(otherBall.style.left);
            const dy = newTop - parseFloat(otherBall.style.top);
            const distance = Math.sqrt(dx * dx + dy * dy);

            if (distance < plinkoBallSize) {
              const angle = Math.atan2(dy, dx);
              velocityX = Math.cos(angle) * plinkoBounceDamping;
              velocityY = Math.sin(angle) * plinkoBounceDamping;
              newLeft = parseFloat(ball.style.left) + velocityX;
              newTop = parseFloat(ball.style.top) + velocityY;
            }
          }
        });

        plinkoPegs.forEach(peg => {
          const pegLeft = parseFloat(peg.style.left);
          const pegTop = parseFloat(peg.style.top);
          const dx = (newLeft + plinkoBallSize / 2) - (pegLeft + peg.offsetWidth / 2);
          const dy = (newTop + plinkoBallSize / 2) - (pegTop + peg.offsetHeight / 2);
          const distance = Math.sqrt(dx * dx + dy * dy);

          if (distance < (plinkoBallSize / 2 + peg.offsetWidth / 2)) {
            const angle = Math.atan2(dy, dx);
            velocityX = Math.cos(angle) * plinkoBounceDamping;
            velocityY = Math.sin(angle) * plinkoBounceDamping;
            newLeft = parseFloat(ball.style.left) + velocityX;
            newTop = parseFloat(ball.style.top) + velocityY;
            applyPlinkoPegGlow(peg);
          }
        });

        const multiplierBoxes = plinkoBoard.querySelectorAll('.plinko-multiplier-box');
        const boxY = parseFloat(multiplierBoxes[0].style.top);

        if (newTop >= boxY - plinkoBallSize) {
          finishPlinkoBall(ball, newLeft, betAmount);
          return;
        }

        ball.style.left = `${newLeft}px`;
        ball.style.top = `${newTop}px`;
        requestAnimationFrame(dropBall);
      }

      requestAnimationFrame(dropBall);
    }

    function finishPlinkoBall(ball, newLeft, betAmount) {
      plinkoBoard.removeChild(ball);
      plinkoBalls = plinkoBalls.filter(b => b !== ball);

      const ballCenterX = newLeft + plinkoBallSize / 2;
      let hitMultiplier = false;

      const multiplierBoxes = plinkoBoard.querySelectorAll('.plinko-multiplier-box');
      for (let i = 0; i < multiplierBoxes.length; i++) {
        const box = multiplierBoxes[i];
        const boxLeft = parseFloat(box.style.left);
        const boxRight = boxLeft + 40;

        if (ballCenterX >= boxLeft && ballCenterX <= boxRight) {
          hitMultiplier = true;
          const multiplier = plinkoMultipliers[i];
          const winAmount = betAmount * multiplier;

          if (winAmount > plinkoMaxWin) {
            plinkoMaxWin = winAmount;
            updatePlinkoMaxWinDisplay();
          }

          plinkoBalance += winAmount;
          updatePlinkoBalance();

          addPlinkoResultItem(winAmount, multiplier);
          applyPlinkoMultiplierGlow(box);
          
          // Send result to server
          sendPlinkoResultToServer(betAmount, winAmount, multiplier);
          break;
        }
      }

      if (!hitMultiplier) {
        const resultItem = document.createElement('div');
        resultItem.className = 'plinko-result-item';
        resultItem.textContent = `Returned: $${betAmount.toLocaleString()}`;
        plinkoResultsDiv.insertBefore(resultItem, plinkoResultsDiv.firstChild);
      }
      // Update session and clear pending state
      savePlinkoSession();
    }

    function addPlinkoResultItem(winAmount, multiplier) {
      const resultItem = document.createElement('div');
      resultItem.className = 'plinko-result-item';

      if (multiplier === 1000) resultItem.classList.add('red');
      else if (multiplier === 0.2) resultItem.classList.add('yellow');
      else if (multiplier === 130 || multiplier === 2) resultItem.classList.add('orange');

      if (winAmount >= 1000000) {
        resultItem.classList.add('rainbow-win');
      }

      resultItem.textContent = `Won: $${winAmount.toLocaleString()} (${multiplier}x)`;
      plinkoResultsDiv.insertBefore(resultItem, plinkoResultsDiv.firstChild);
    }

    function sendPlinkoResultToServer(betAmount, winAmount, multiplier) {
      fetch(`${API_URL}/games/plinko`, {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: currentUser.username,
          wager: betAmount,
          winAmount: winAmount,
          multiplier: multiplier
        })
      })
      .then(res => res.json())
      .then(data => {
        if (data.user) {
          currentUser = data.user;
          plinkoBalance = currentUser.balance;
          updatePlinkoBalance();
        }
      })
      .catch(err => console.error('Plinko error:', err));
    }

    function startPlinkoAutoBet() {
      if (plinkoAutoBetInterval) return;
      plinkoCurrentBetDelay = 150;
      plinkoBet();

      function autoBet() {
        plinkoBet();
        plinkoCurrentBetDelay = Math.max(PLINKO_MIN_BET_DELAY, plinkoCurrentBetDelay - PLINKO_ACCELERATION_RATE);
        plinkoAutoBetInterval = setTimeout(autoBet, plinkoCurrentBetDelay);
        savePlinkoSession();
      }

      plinkoAutoBetInterval = setTimeout(autoBet, plinkoCurrentBetDelay);
      savePlinkoSession();
    }

    function stopPlinkoAutoBet() {
      if (plinkoAutoBetInterval) {
        clearTimeout(plinkoAutoBetInterval);
        plinkoAutoBetInterval = null;
        savePlinkoSession();
      }
    }

    function allInPlinko() {
      if (plinkoBalance <= 0) {
        alert('Insufficient balance!');
        return;
      }
      const betAmount = plinkoBalance;
      plinkoBalance = 0;
      updatePlinkoBalance();
      createPlinkoBall(betAmount);
    }

    function resetPlinkoGame() {
      plinkoBalance = currentUser.balance;
      updatePlinkoBalance();
      plinkoResultsDiv.innerHTML = '';

      plinkoBalls.forEach(ball => plinkoBoard.removeChild(ball));
      plinkoBalls = [];

      plinkoGraphContainer.innerHTML = '';
      plinkoBalanceHistory = [plinkoBalance];
      plinkoMaxWin = 0;
      updatePlinkoMaxWinDisplay();
      // Clear saved session when user intentionally resets
      try { localStorage.removeItem(`plinkoSession_${currentUser ? currentUser.username : 'guest'}`); } catch (e) {}
    }

    // Helper: detect any active game state to warn on refresh
    function isAnyGameInProgress() {
      try {
        if (typeof blackjackState !== 'undefined' && blackjackState.gameInProgress) return true;
      } catch (e) {}
      if (plinkoAutoBetInterval) return true;
      if (plinkoBalls && plinkoBalls.length > 0) return true;
      return false;
    }

    // Warn user if they try to refresh while a bet is mid-flight; also persist sessions above
    window.addEventListener('beforeunload', function (e) {
      if (isAnyGameInProgress()) {
        e.preventDefault();
        e.returnValue = '';
        return '';
      }
    });

    // Restore Plinko session if present (called from initPlinko)
    // initPlinko will call loadPlinkoSession() after setting initial values

    function updatePlinkoMaxWinDisplay() {
      const maxWinElement = document.getElementById('plinkoMaxWin');
      if (plinkoMaxWin > 0) {
        maxWinElement.textContent = `Max Win: $${plinkoMaxWin.toLocaleString()}`;
        maxWinElement.classList.add('visible');
      } else {
        maxWinElement.textContent = '';
        maxWinElement.classList.remove('visible');
      }
    }

    // Mines feature removed
    // LEADERBOARD
    async function loadLeaderboard() {
      try {
        const response = await fetch(`${API_URL}/users`);
        const result = await response.json();

        if (result.users && result.users.length > 0) {
          document.getElementById('leaderboardList').innerHTML = result.users.slice(0, 10).map((user, i) => `
            <div style="background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%); border: 1px solid #475569; padding: 20px; border-radius: 10px; display: flex; justify-content: space-between; align-items: center;">
              <div>
                <div style="font-size:1.2em;font-weight:bold;">ü•á #${i + 1}</div>
                <div style="color:#cbd5e1;font-weight:500;">${user.username}</div>
              </div>
              <div style="text-align:right;">
                <div style="font-size:1.5em;font-weight:bold;color:#00ff88;">${user.balance}</div>
                <div style="color:#64748b;font-size:0.9em;">coins</div>
              </div>
            </div>
          `).join('');
        }
      } catch (error) {}
    }

    // Mines helper removed

    // WITHDRAW
    async function withdraw() {
      const amount = parseFloat(document.getElementById('withdrawAmount').value);

      if (!amount || amount <= 0) {
        showMessage('Enter valid amount', 'error');
        return;
      }
      if (amount > currentUser.balance) {
        showMessage('Insufficient balance', 'error');
        return;
      }

      try {
        const response = await fetch(`${API_URL}/withdraw`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: currentUser.username, amount })
        });
        const result = await response.json();

        if (response.ok) {
          currentUser = result.user;
          lastBalance = currentUser.balance;
          updateBalance();
          showMessage(`‚úÖ Withdrawal of ${amount} coins queued!`, 'success');
          document.getElementById('withdrawAmount').value = '';
        }
      } catch (error) {
        showMessage('Withdrawal failed', 'error');
      }
    }

    // UTILITIES
    function showResult(title, titleClass, details, winnings, bet) {
      const titleEl = document.getElementById('resultTitle');
      titleEl.textContent = title;
      titleEl.className = `result-title ${titleClass}`;
      document.getElementById('resultDetails').innerHTML = `
        ${details}
        <hr style="border:none;border-top:1px solid #475569;margin:20px 0;">
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;">
          <div><div style="color:#64748b;font-size:0.85em;">BET</div><div style="font-size:1.5em;font-weight:bold;">${bet}</div></div>
          <div><div style="color:#64748b;font-size:0.85em;">WINNINGS</div><div class="${winnings > 0 ? 'result-win-amount' : 'result-lose-amount'}" style="font-size:1.5em;font-weight:bold;">${winnings > 0 ? '+' : ''} ${winnings}</div></div>
        </div>
        <div style="margin-top:20px;color:#cbd5e1;font-size:0.9em;">Balance: <strong>${currentUser.balance}</strong> coins</div>
      `;
      document.getElementById('resultModal').classList.add('show');
    }

    function closeResult() {
      document.getElementById('resultModal').classList.remove('show');
    }

    function showMessage(text, type) {
      const msg = document.getElementById('messageContainer');
      msg.textContent = text;
      msg.className = `message show ${type}`;
      setTimeout(() => msg.classList.remove('show'), 5000);
    }

    async function unlinkDiscord() {
      if (!currentUser) return;
      
      if (!confirm('Are you sure you want to unlink your Discord account? You will need to link again to use Discord login.')) {
        return;
      }

      try {
        const response = await fetch(`${API_URL}/unlink-discord`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify({ username: currentUser.username })
        });
        const result = await response.json();
        
        if (response.ok) {
          currentUser.discordId = null;
          currentUser.discordTag = null;
          localStorage.setItem('currentUser', JSON.stringify(currentUser));
          document.getElementById('unlinkBtn').style.display = 'none';
          showMessage('‚úÖ Discord account unlinked successfully', 'success');
        } else {
          showMessage('Failed to unlink Discord account: ' + result.error, 'error');
        }
      } catch (error) {
        showMessage('Error unlinking account: ' + error.message, 'error');
      }
    }

    function logout() {
      if (confirm('Logout?')) {
        currentUser = null;
        localStorage.removeItem('currentUser');
        document.getElementById('loginScreen').style.display = 'flex';
        document.getElementById('mainLayout').classList.remove('active');
        document.getElementById('loginUsername').value = '';
      }
    }

    // Mines removed
    // END MINES GAME

    // Crash removed
  </script>
  <!-- mines script removed -->
</body>
</html>